function [monitor, stimImage, glow, BGColor, soundwave] = openFlickerWindow(numOfFlicker, screenNum)
% stimImage: textures, positions
% glow: textures, positions

% screensize
screenSize.height = 1080;
screenSize.width =  1920;


%if numOfFlicker == 10
    %stimImage1File = './figure/checkerboard192a.bmp';
    %stimImage2File = './figure/checkerboard192b.bmp';
    %stimImage1File = './figure/white_192.bmp';
    %stimImage2File = './figure/black_192.bmp';
    stimImage1File = './figure/black_192.bmp';
    stimImage2File = './figure/white_192.bmp';
    glowFile = './figure/glow192.bmp';
    
%else
    %stimImage1File = './figure/checkerboard_2cpd_a.bmp';
    %stimImage2File = './figure/checkerboard_2cpd_b.bmp';
%    stimImage1File = './figure/white_2cpd.bmp';
%    stimImage2File = './figure/black_2cpd.bmp';
%    glowFile = './figure/glow.bmp';
    %ECFile = './figure/eyecatcher192.bmp';
%end
ECFile = './figure/eyecatcher.bmp';

%gray
BGColor = [85 85 102];
%white
%BGColor = [255 255 255];
%black
%BGColor = [0 0 0];

monitor = Screen('OpenWindow', screenNum);

stimImage1 = imread(stimImage1File);
stimImage2 = imread(stimImage2File);
stimImageInfo = imfinfo(stimImage1File);

stimImage1 = Screen('MakeTexture', monitor, stimImage1);
stimImage2 = Screen('MakeTexture', monitor, stimImage2);
stimImage.textures = [stimImage1 stimImage2];
stimImageCorner = floor([-abs([stimImageInfo.Width stimImageInfo.Height]) abs([stimImageInfo.Width stimImageInfo.Height])]/2);

EC = imread(ECFile);
ECInfo = imfinfo(ECFile);

EC.texture = Screen('MakeTexture', monitor, EC);
ECCorner = floor([-abs([ECInfo.Width ECInfo.Height]) abs([ECInfo.Width ECInfo.Height])]/2);

glow = imread(glowFile);
glowInfo = imfinfo(glowFile);

glow.texture = Screen('MakeTexture', monitor, glow);
glowCorner = floor([-abs([glowInfo.Width glowInfo.Height]) abs([glowInfo.Width glowInfo.Height])]/2);


tone2 = [880 1318.51]; % Hz
tone4 = [783.99 987.77 1174.66 1567.98]; % Hz
tone6 = [587.33 783.99 987.77 1174.66 1567.98 1975.53]; %Hz
tone8 = [493.88 587.33 783.99 987.77 1174.66 1567.98 1975.53 2349.32]; % Hz
tone10 = [392.00 493.88 587.33 783.99 987.77 1174.66 1567.98 1975.53 2349.32 3135.96]; % Hz
soundLength = .125;


HideCursor;
priorityLevel = MaxPriority(monitor);
Priority(priorityLevel);
Screen('FillRect', monitor, BGColor);
Screen('TextColor', monitor, 0);
Screen('Flip', monitor)


switch numOfFlicker
	case 2
		stimImage.positions = repmat([...
            720 600;...
			1104 600 ...
			], 1, 2)...
			+ repmat(stimImageCorner, 2, 1);
		EC.positions = repmat([...
            720 756;...
			1104 756 ...
			], 1, 2)...
			+ repmat(ECCorner, 2, 1);
        
		soundwave = sin(sort(tone2(:))*(0:(round(8192*soundLength) - 1))*2*pi/8192);
	case 4
		stimImage.positions = repmat([...
            960 300;...
			...
			600 540;...
			1320 540;...
			...
			960 780 ...
			], 1, 2)...
			+ repmat(stimImageCorner, 4, 1);
		EC.positions = repmat(stimImage.positions(:,1:2) + repmat([120 300],4,1),1,2) + repmat(ECCorner, 4, 1);
		soundwave = sin(sort(tone4(:))*(0:(round(8192*soundLength) - 1))*2*pi/8192);
	case 6
		stimImage.positions = repmat([...
			480 300;...
			960 300;...
			1440 300;...
			...
			480 780;...
			960 780;...
			1440 780 ...
			], 1, 2)...
			+ repmat(stimImageCorner, 6, 1);
		
		soundwave = sin(sort(tone6(:))*(0:(round(8192*soundLength) - 1))*2*pi/8192);
		
	case 8
		stimImage.positions = repmat([...
			382 348;...
			766 348;...
			1150 348;...
			1534 348;...
      ...
			382 732;...
			766 732;...
			1150 732;...
			1534 732;...
			], 1, 2)...
			+ repmat(stimImageCorner, 8, 1);
			
			
			
      EC.positions = repmat([...
			382 504;...
			766 504;...
			1150 504;...
			1534 504;...
			...
			382 888;...
			766 888;...
			1150 888;...
			1534 888;...
			], 1, 2)...
			+ repmat(ECCorner, 8, 1);
    
    soundwave = sin(sort(tone8(:))*(0:(round(8192*soundLength) - 1))*2*pi/8192);
	
	case 10
		stimImage.positions = repmat([...
			192 348;...
			576 348;...
			960 348;...
			1344 348;...
			1728 348;...
			...
			192 732;...
			576 732;...
			960 732;...
			1344 732;...
			1728 732;...
			], 1, 2)...
			+ repmat(stimImageCorner, 10, 1);
        EC.positions = repmat([...
			192 504;...
			576 504;...
			960 504;...
			1344 504;...
			1728 504;...
			...
			192 888;...
			576 888;...
			960 888;...
			1344 888;...
			1728 888;...
			], 1, 2)...
			+ repmat(ECCorner, 10, 1);
		
		soundwave = sin(sort(tone10(:))*(0:(round(8192*soundLength) - 1))*2*pi/8192);
		
		case 16
		firstPosition = [382 110];
		intarval.height = 288;
		intarval.width = 384;
		widthVector = repmat((0:3)'*intarval.width, 4, 1);
		heightVector =[zeros(4,1); repmat(intarval.height,4,1); repmat(2*intarval.height,4,1); repmat(3*intarval.height,4,1)];
		
		stimImage.positions = repmat(firstPosition, 16, 2) + repmat([widthVector, heightVector],1,2) + repmat(stimImageCorner, 16, 1);
		EC.positions =  repmat(firstPosition+[0 200], 16, 2) + repmat([widthVector, heightVector],1,2) + repmat(stimImageCorner, 16, 1);
		
 		soundwave = sin(sort(tone4(:))*(0:(round(8192*soundLength) - 1))*2*pi/8192);
		
end


glow.positions = stimImage.positions + repmat((glowCorner - stimImageCorner), numOfFlicker, 1);

end
